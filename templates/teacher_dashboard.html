<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SparkAI â€¢ Teacher Dashboard</title>

    <!-- Font Awesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#2563eb",
              success: "#10b981",
              warning: "#f59e0b",
              danger: "#ef4444",
              purple: "#8b5cf6",
              pink: "#ec4899",
            },
          },
        },
      };
    </script>
    <style>
      .stat-card {
        transition: all 0.3s ease;
      }
      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }
      .score-badge {
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 600;
      }
      .tooltip {
        position: relative;
        display: inline-block;
      }
      .tooltip .tooltiptext {
        visibility: hidden;
        width: 120px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 5px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        margin-left: -60px;
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 0.7rem;
      }
      .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
      }
    </style>
  </head>

  <body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm sticky top-0 z-10">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <div class="flex items-center">
            <div class="flex-shrink-0 flex items-center">
              <i
                class="fas fa-chalkboard-teacher text-primary text-2xl mr-3"
              ></i>
              <h1 class="text-xl font-bold text-gray-900">
                SparkAI Teacher Dashboard
              </h1>
            </div>
          </div>
          <div class="flex items-center space-x-4">
            <span class="text-sm text-gray-600">
              <i class="fas fa-calendar-alt mr-1"></i>
              <span id="current-date"></span>
            </span>
            <a
              href="/logout"
              class="text-red-600 hover:text-red-800 font-medium"
            >
              <i class="fas fa-sign-out-alt mr-2"></i>Logout
            </a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
      <!-- Stats Cards - Updated for new scoring system -->
      <div class="mb-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Class Overview</h2>
        <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-5">
          <div class="bg-white overflow-hidden shadow rounded-lg stat-card">
            <div class="p-5">
              <div class="flex items-center">
                <div class="flex-shrink-0 bg-blue-100 rounded-lg p-3">
                  <i class="fas fa-users text-primary text-xl"></i>
                </div>
                <div class="ml-5 w-0 flex-1">
                  <dl>
                    <dt class="text-sm font-medium text-gray-500 truncate">
                      Total Students
                    </dt>
                    <dd class="text-2xl font-semibold text-gray-900">
                      {{ total_students }}
                    </dd>
                  </dl>
                </div>
              </div>
            </div>
          </div>

          <div class="bg-white overflow-hidden shadow rounded-lg stat-card">
            <div class="p-5">
              <div class="flex items-center">
                <div class="flex-shrink-0 bg-green-100 rounded-lg p-3">
                  <i class="fas fa-calendar-check text-success text-xl"></i>
                </div>
                <div class="ml-5 w-0 flex-1">
                  <dl>
                    <dt class="text-sm font-medium text-gray-500 truncate">
                      Avg Attendance
                    </dt>
                    <dd class="text-2xl font-semibold text-gray-900">
                      {{ avg_attendance }}%
                    </dd>
                  </dl>
                </div>
              </div>
            </div>
          </div>

          <div class="bg-white overflow-hidden shadow rounded-lg stat-card">
            <div class="p-5">
              <div class="flex items-center">
                <div class="flex-shrink-0 bg-purple-100 rounded-lg p-3">
                  <i class="fas fa-pen-to-square text-purple-600 text-xl"></i>
                </div>
                <div class="ml-5 w-0 flex-1">
                  <dl>
                    <dt class="text-sm font-medium text-gray-500 truncate">
                      Avg Input Score
                    </dt>
                    <dd class="text-2xl font-semibold text-gray-900">
                      {{ avg_input }}/60
                    </dd>
                  </dl>
                </div>
              </div>
            </div>
          </div>

          <div class="bg-white overflow-hidden shadow rounded-lg stat-card">
            <div class="p-5">
              <div class="flex items-center">
                <div class="flex-shrink-0 bg-blue-100 rounded-lg p-3">
                  <i class="fas fa-graduation-cap text-blue-600 text-xl"></i>
                </div>
                <div class="ml-5 w-0 flex-1">
                  <dl>
                    <dt class="text-sm font-medium text-gray-500 truncate">
                      Avg End-term
                    </dt>
                    <dd class="text-2xl font-semibold text-gray-900">
                      {{ avg_endterm }}/40
                    </dd>
                  </dl>
                </div>
              </div>
            </div>
          </div>

          <div class="bg-white overflow-hidden shadow rounded-lg stat-card">
            <div class="p-5">
              <div class="flex items-center">
                <div class="flex-shrink-0 bg-amber-100 rounded-lg p-3">
                  <i class="fas fa-star text-amber-600 text-xl"></i>
                </div>
                <div class="ml-5 w-0 flex-1">
                  <dl>
                    <dt class="text-sm font-medium text-gray-500 truncate">
                      Avg Total
                    </dt>
                    <dd class="text-2xl font-semibold text-gray-900">
                      {{ avg_total }}/100
                    </dd>
                  </dl>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Filters -->
      <div class="bg-white shadow rounded-lg mb-8 p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Filter Students</h3>
        <form method="GET" action="/teacher-dashboard" class="space-y-4">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <input
              type="text"
              name="search"
              value="{{ search_query }}"
              placeholder="Search by name or roll"
              class="border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary block w-full"
            />

            <select
              name="risk"
              class="border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary block w-full"
            >
              <option value="">All Risk Levels</option>
              <option value="High" {% if filter_risk == "High" %}selected{% endif %}>
                High Risk
              </option>
              <option value="Medium" {% if filter_risk == "Medium" %}selected{% endif %}>
                Medium Risk
              </option>
              <option value="Low" {% if filter_risk == "Low" %}selected{% endif %}>
                Low Risk
              </option>
            </select>

            <select
              name="performance"
              class="border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary block w-full"
            >
              <option value="">All Performance</option>
              <option value="Excellent" {% if filter_perf == "Excellent" %}selected{% endif %}>
                Excellent (80-100)
              </option>
              <option value="Good" {% if filter_perf == "Good" %}selected{% endif %}>
                Good (70-79)
              </option>
              <option value="Average" {% if filter_perf == "Average" %}selected{% endif %}>
                Average (60-69)
              </option>
              <option value="Poor" {% if filter_perf == "Poor" %}selected{% endif %}>
                Needs Improvement (<60)
              </option>
            </select>

            <select
              name="sort"
              class="border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary block w-full"
            >
              <option value="">Sort By</option>
              <option value="attendance" {% if sort_by == "attendance" %}selected{% endif %}>
                Attendance (High to Low)
              </option>
              <option value="total_score" {% if sort_by == "total_score" %}selected{% endif %}>
                Total Score (High to Low)
              </option>
              <option value="risk_high" {% if sort_by == "risk_high" %}selected{% endif %}>
                Risk Level (High to Low)
              </option>
            </select>
          </div>

          <div class="flex space-x-3">
            <button
              type="submit"
              class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"
            >
              Apply Filters
            </button>
            <a
              href="/teacher-dashboard"
              class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"
            >
              Clear Filters
            </a>
          </div>
        </form>
      </div>

      <!-- Students Table - Updated with new columns -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-4 py-5 sm:p-6">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-medium text-gray-900">
              Student Performance
            </h3>
            <span class="text-sm text-gray-500"
              >Total: 100 marks (Input 60 + End-term 40)</span
            >
          </div>

          {% if at_risk_students and at_risk_students|length > 0 %}
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th
                    scope="col"
                    class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Roll No
                  </th>
                  <th
                    scope="col"
                    class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Name
                  </th>
                  <th
                    scope="col"
                    class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Attendance
                  </th>
                  <th
                    scope="col"
                    class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    <div class="tooltip">
                      A(10)
                      <span class="tooltiptext">Assignments</span>
                    </div>
                  </th>
                  <th
                    scope="col"
                    class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    <div class="tooltip">
                      M(20)
                      <span class="tooltiptext">Midterm</span>
                    </div>
                  </th>
                  <th
                    scope="col"
                    class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    <div class="tooltip">
                      I(30)
                      <span class="tooltiptext">Internal Score</span>
                    </div>
                  </th>
                  <th
                    scope="col"
                    class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    <div class="tooltip">
                      End-term(40)
                      <span class="tooltiptext">Predicted End-term</span>
                    </div>
                  </th>
                  <th
                    scope="col"
                    class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    <div class="tooltip">
                      Total(100)
                      <span class="tooltiptext">A+M+T+End-term</span>
                    </div>
                  </th>
                  <th
                    scope="col"
                    class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Performance
                  </th>
                  <th
                    scope="col"
                    class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Risk Level
                  </th>
                  <th
                    scope="col"
                    class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                {% for student in at_risk_students %}
                <tr class="hover:bg-gray-50 transition-colors">
                  <td
                    class="px-3 py-4 whitespace-nowrap text-sm font-medium text-gray-900"
                  >
                    {{ student.roll_no }}
                  </td>
                  <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900">
                    {{ student.name }}
                  </td>
                  <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900">
                    <span class="font-medium">{{ student.attendance }}%</span>
                  </td>
                  <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900">
                    <span class="score-badge bg-green-100 text-green-800">
                      {{ student.assignments_score|default('0') }}/10
                    </span>
                  </td>
                  <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900">
                    <span class="score-badge bg-amber-100 text-amber-800">
                      {{ student.midterm_score|default('0') }}/20
                    </span>
                  </td>
                  <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900">
                    <span class="score-badge bg-purple-100 text-purple-800">
                      {{ student.internal_score|default('0') }}/30
                    </span>
                  </td>
                  <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900">
                    <span class="score-badge bg-blue-100 text-blue-800">
                      {{ student.final_score|default('0') }}/40
                    </span>
                  </td>
                  <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900">
                    <span
                      class="font-bold {% if student.total_score >= 80 %}text-green-600{% elif student.total_score >= 70 %}text-blue-600{% elif student.total_score >= 60 %}text-amber-600{% else %}text-red-600{% endif %}"
                    >
                      {{ student.total_score }}/100
                    </span>
                  </td>
                  <td class="px-3 py-4 whitespace-nowrap">
                    <span
                      class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full {% if student.performance == 'Excellent' %}bg-green-100 text-green-800 {% elif student.performance == 'Good' %}bg-blue-100 text-blue-800 {% elif student.performance == 'Average' %}bg-yellow-100 text-yellow-800 {% else %}bg-red-100 text-red-800{% endif %}"
                    >
                      {{ student.performance }}
                    </span>
                  </td>
                  <td class="px-3 py-4 whitespace-nowrap">
                    <span
                      class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full {% if student.risk_level == 'High' %}bg-red-100 text-red-800 {% elif student.risk_level == 'Medium' %}bg-yellow-100 text-yellow-800 {% else %}bg-green-100 text-green-800{% endif %}"
                    >
                      {{ student.risk_level }}
                    </span>
                  </td>
                  <td class="px-3 py-4 whitespace-nowrap text-sm font-medium">
                    <a
                      href="/student/{{ student.roll_no }}"
                      class="text-primary hover:text-blue-700"
                    >
                      <i class="fas fa-eye mr-1"></i>View
                    </a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="text-center py-12">
            <i class="fas fa-users text-gray-400 text-5xl mb-4"></i>
            <h3 class="text-lg font-medium text-gray-900 mb-2">
              No Students Found
            </h3>
            <p class="text-gray-500">
              {% if search_query or filter_risk or filter_perf %} Try adjusting
              your search filters {% else %} No student data available in the
              system {% endif %}
            </p>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Performance Summary - Updated thresholds -->
      {% if perf_counts %}
      <div class="mt-8 bg-white shadow rounded-lg p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">
          Performance Summary (Based on Total Score 100)
        </h3>
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
          {% for label, count in perf_counts.items() %}
          <div
            class="text-center p-4 rounded-lg {% if label == 'Excellent' %}bg-green-50 {% elif label == 'Good' %}bg-blue-50 {% elif label == 'Average' %}bg-yellow-50 {% else %}bg-red-50{% endif %}"
          >
            <div
              class="text-2xl font-bold {% if label == 'Excellent' %}text-green-700 {% elif label == 'Good' %}text-blue-700 {% elif label == 'Average' %}text-yellow-700 {% else %}text-red-700{% endif %}"
            >
              {{ count }}
            </div>
            <div class="text-sm text-gray-600">
              {{ label }} {% if label == 'Excellent' %}(80-100){% elif label ==
              'Good' %}(70-79){% elif label == 'Average' %}(60-69){% else
              %}(<60){% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Quick Actions -->
      <div class="mt-8 flex flex-wrap gap-4">
        <a
          href="/prediction-history"
          class="inline-flex items-center px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition"
        >
          <i class="fas fa-history mr-2"></i>View Prediction History
        </a>
        <a
          href="/chatbot"
          class="inline-flex items-center px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition"
        >
          <i class="fas fa-robot mr-2"></i>AI Assistant
        </a>
        <a
          href="/"
          class="inline-flex items-center px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition"
        >
          <i class="fas fa-home mr-2"></i>Home
        </a>
      </div>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        console.log("Teacher dashboard loaded successfully");

        // Display current date
        const options = { year: "numeric", month: "long", day: "numeric" };
        const today = new Date().toLocaleDateString(undefined, options);
        document.getElementById("current-date").textContent = today;
      });
    </script>
  </body>
</html>
